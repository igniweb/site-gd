;(function (app, $, window, document) {

    'use strict';

    var module = {
        url: '/search',
        language: 'fr',
        minimumInputLength: 3
    };

    // --------------------------------------------------------------------------------------------

    function _onDocumentReady() {
        _initSelect2($('#search'));
    }

    function _initSelect2($input) {
        $input.select2({
            ajax: {
                url: module.url,
                dataType: 'json',
                delay: 250,
                data: function (params) {
                    return {
                        q: params.term,
                        page: params.page
                    };
                },
                processResults: function (data, page) {
                    // As described in HomeController->search()
                    return {
                        results: data.results
                    };
                },
                cache: true
            },
            escapeMarkup: function (markup) {
                // Do not escape markup .. generated by us
                return markup;
            },
            language: module.language,
            minimumInputLength: module.minimumInputLength,
            templateResult: _templateResult,
            templateSelection: _templateSelection
        });
    }

    function _templateResult(result) {
        return result.templateResult;
    }

    function _templateSelection(result) {
        return result.templateSelection;
    }

    // --------------------------------------------------------------------------------------------

    module.run = function () {
        $(document).ready(_onDocumentReady);
    };

    app.search = module;

})(App, jQuery, window, document);
